<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Tappa 12 Porta San Demetrio</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    background: #fffcef;
    font-family: 'Playfair Display', serif;
    color: #195E40;
    margin: 50px auto;
    max-width: 650px;
    padding: 30px 25px;
    box-sizing: border-box;
  }
  h1 {
    text-align: center;
    font-size: 3rem;
    color: #0C4B40;
    margin-bottom: 1.2rem;
    letter-spacing: 1.5px;
  }
  .hidden {
    display: none;
  }
  p.riferimento {
    font-style: italic;
    font-size: 1.1rem;
    color: #bca55a;
    background-color: #f9f5df;
    padding: 10px 15px;
    border-left: 6px solid #bca55a;
    margin-bottom: 3rem;
    border-radius: 6px;
  }
  label {
    font-weight: 700;
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    display: block;
    color: #4a5b2f;
  }
  input[type=text] {
    font-family: 'Playfair Display', serif;
    font-size: 1.15rem;
    border-radius: 15px;
    border: 2px solid #bca55a;
    padding: 14px 16px;
    width: 100%;
    margin-bottom: 1.5rem;
    box-sizing: border-box;
    color: #49592e;
  }
  button {
    background-color: #0C4B40;
    color: white;
    border: none;
    width: 100%;
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    font-weight: 700;
    padding: 15px 0;
    border-radius: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    letter-spacing: 1.2px;
    margin-bottom: 15px;
  }
  button:disabled {
    background-color: #9e9b6d;
    cursor: not-allowed;
  }
  #infoText {
    font-style: italic;
    color: #6a7a39;
    text-align: center;
    margin-top: -1rem;
    margin-bottom: 2rem;
  }
  .message {
    font-weight: bold;
    margin-top: 0.5rem;
  }
  .message.error {
    color: red;
  }
  .message.success {
    color: green;
  }
  #btnClassifica {
    display: none;
    margin: 3rem auto 0 auto;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    font-weight: bold;
    background-color: #0C4B40;
    color: white;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    text-align: center;
    width: max-content;
  }
</style>
</head>
<body>

<h1>Tappa 12 Porta San Demetrio</h1>

<div id="codiceBox">
  <label for="previousCode">Inserisci il codice segreto ottenuto al termine della tappa precedente</label>
  <input type="text" id="previousCode" autocomplete="off" placeholder="Inserisci codice..." />
  <button id="confirmBtn" disabled>Conferma codice e sblocca</button>
  <div id="infoText">Inserisci il codice corretto per sbloccare l'enigma finale.</div>
</div>

<div id="riferimentoBox" class="riferimento hidden">
  La Porta San Demetrio era l'antica via d'accesso a Ostuni provenendo da Brindisi, una località di rilievo nell'antichità per commercio e strategia militare. Nel cuore del centro storico, il Labirinto Bianco rappresenta una sfida di intelletti e spirito a cui siete ora chiamati.
</div>

<div id="enigma1" class="hidden">
  <h2>Enigma 1</h2>
  <p>La Porta San Demetrio proteggeva l’accesso alla città verso quale importante località?</p>
  <label for="risposta1">Risposta:</label>
  <input type="text" id="risposta1" autocomplete="off" placeholder="Scrivi la risposta qui..." />
  <div id="msg1" class="message"></div>
  <button id="check1">Verifica Risposta</button>
</div>

<div id="enigma2" class="hidden">
  <h2>Enigma 2 (Prova fisica)</h2>
  <p>Il narratore errante farà il suo ingresso, vi chiederà una prova finale e vi consegnerà il codice della vittoria.</p>
  <label for="codiceSegreto">Inserisci il codice segreto finale:</label>
  <input type="text" id="codiceSegreto" autocomplete="off" placeholder="Codice segreto" />
  <div id="msg2" class="message"></div>
  <button id="check2">Completa la Caccia</button>
</div>

<button id="btnClassifica">Vai alla Classifica e Festeggia!</button>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const correctCode = "fede";
const rispostaCorretta1 = "brindisi";
const codiceCorretto2 = "vittoria";

const previousCodeInput = document.getElementById('previousCode');
const confirmBtn = document.getElementById('confirmBtn');
const infoText = document.getElementById('infoText');
const codiceBox = document.getElementById('codiceBox');
const riferimentoBox = document.getElementById('riferimentoBox');
const enigma1 = document.getElementById('enigma1');
const enigma2 = document.getElementById('enigma2');
const msg1 = document.getElementById('msg1');
const msg2 = document.getElementById('msg2');
const btnClassifica = document.getElementById('btnClassifica');

function checkCodeInput() {
  const val = previousCodeInput.value.trim().toLowerCase();
  if (val === correctCode.toLowerCase()) {
    confirmBtn.disabled = false;
    infoText.textContent = "Codice corretto! Premi il pulsante per proseguire.";
  } else {
    confirmBtn.disabled = true;
    infoText.textContent = "Inserisci il codice corretto per sbloccare l'enigma e procedere.";
    riferimentoBox.classList.add("hidden");
    enigma1.classList.add("hidden");
    enigma2.classList.add("hidden");
    msg1.textContent = "";
    msg2.textContent = "";
    btnClassifica.style.display = 'none';
  }
}

previousCodeInput.addEventListener('input', checkCodeInput);

confirmBtn.addEventListener('click', () => {
  if (confirmBtn.disabled) return;
  codiceBox.style.display = 'none';
  riferimentoBox.classList.remove("hidden");
  enigma1.classList.remove("hidden");
  window.scrollTo(0, document.body.scrollHeight);
});

document.getElementById('check1').addEventListener('click', () => {
  const risposta = document.getElementById('risposta1').value.trim().toLowerCase();
  if (risposta === rispostaCorretta1) {
    msg1.textContent = "Risposta corretta! Procedi al secondo enigma.";
    msg1.className = "message success";
    setTimeout(() => {
      enigma2.classList.remove("hidden");
      window.scrollTo(0, document.body.scrollHeight);
    }, 1200);
  } else {
    msg1.textContent = "Risposta sbagliata! Riprova tra 15 secondi.";
    msg1.className = "message error";
    setTimeout(() => {
      msg1.textContent = "";
      msg1.className = "message";
    }, 15000);
  }
});

document.getElementById('check2').addEventListener('click', () => {
  const codice = document.getElementById('codiceSegreto').value.trim().toLowerCase();
  if (codice === codiceCorretto2) {
    msg2.textContent = "Complimenti, avete completato la caccia al tesoro!";
    msg2.className = "message success";
    btnClassifica.style.display = "block";
    window.scrollTo(0, document.body.scrollHeight);
  } else {
    msg2.textContent = "Codice errato! Riprova.";
    msg2.className = "message error";
    setTimeout(() => {
      msg2.textContent = "";
      msg2.className = "message";
    }, 10000);
  }
});

btnClassifica.addEventListener('click', () => {
  const confetti = confettiLib.create(null, {resize: true});
  confetti({
    particleCount: 300,
    spread: 120,
    origin: { y: 0.6 }
  });
  setTimeout(() => {
    window.location.href = 'classifica.html';
  }, 3000);
});

let confettiLib = null;
window.onload = () => {
  confettiLib = window.confetti;
  checkCodeInput(); // verifica stato iniziale input
};
</script>

</body>
</html>
